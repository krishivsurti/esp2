<!DOCTYPE html>
<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <title>Fast RC Controller</title>
  <style>
    body { background-color: #1a1a1a; color: white; font-family: sans-serif; text-align: center; touch-action: none; }
    h2 { margin: 10px 0; }
    
    /* Layout */
    .container { display: flex; justify-content: space-between; height: 80vh; padding: 20px; }
    .column { width: 45%; display: flex; flex-direction: column; justify-content: center; align-items: center; }

    /* Sliders */
    input[type=range] { -webkit-appearance: none; background: #333; border-radius: 10px; outline: none; }
    input[type=range]::-webkit-slider-thumb { -webkit-appearance: none; background: #00e5ff; width: 40px; height: 40px; border-radius: 50%; cursor: pointer; }

    /* Steering (Horizontal) */
    #steerSlider { width: 100%; height: 20px; }

    /* Throttle (Vertical) */
    .vertical-wrapper { width: 60px; height: 300px; display: flex; justify-content: center; }
    #throttleSlider { width: 300px; height: 60px; transform: rotate(-90deg); }

    /* Buttons */
    .btn-grid { display: flex; gap: 20px; margin-top: 20px; justify-content: center; }
    .btn { width: 80px; height: 80px; border: none; border-radius: 50%; font-size: 14px; font-weight: bold; cursor: pointer; color: white; transition: 0.2s; }
    .btn-off { background-color: #444; }
    .btn-on { background-color: #00e5ff; box-shadow: 0 0 15px #00e5ff; color: black; }
  </style>

  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
</head>
<body>

  <h2>RC CONTROL V2 (FAST)</h2>

  <div class="container">
    <div class="column">
      <h3>STEERING</h3>
      <input type="range" id="steerSlider" min="-100" max="100" value="0">
      <p>Angle: <span id="sVal">0</span></p>
    </div>

    <div class="column">
      <h3>THROTTLE</h3>
      <div class="vertical-wrapper">
        <input type="range" id="throttleSlider" min="-100" max="100" value="0">
      </div>
      <p>Speed: <span id="tVal">0</span></p>
    </div>
  </div>

  <div class="btn-grid">
    <button id="btnLight" class="btn btn-off" onclick="toggleLight()">LIGHTS</button>
    <button id="btnHorn" class="btn btn-off" onmousedown="setHorn(1)" onmouseup="setHorn(0)" ontouchstart="setHorn(1)" ontouchend="setHorn(0)">HORN</button>
  </div>

  <script>
    // --- 1. YOUR FIREBASE CONFIG ---
    // (Replace these with your actual keys from Firebase Console)
    const firebaseConfig = {
      apiKey: "AIzaSyCFEW0WjgjXW3XY520ZGnt8mVZhLMaQOKA",
      databaseURL: "https://esp32-9725b-default-rtdb.firebaseio.com/"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // --- 2. CONTROLS ---
    const steerSlider = document.getElementById("steerSlider");
    const throttleSlider = document.getElementById("throttleSlider");
    
    let steerVal = 0;
    let throttleVal = 0;
    let lightState = 0;
    
    // Rate Limiter: Only send data every 50ms to prevent lag
    let lastSent = 0;

    function sendData() {
      const now = Date.now();
      if (now - lastSent > 50) { // 50ms limit
        db.ref('car/controls').set({
          s: parseInt(steerVal),
          t: parseInt(throttleVal)
        });
        lastSent = now;
      }
    }

    // Steering Listener
    steerSlider.oninput = function() {
      steerVal = this.value;
      document.getElementById("sVal").innerText = steerVal;
      sendData();
    };
    // Auto-center Steering on release
    steerSlider.onchange = function() {
      this.value = 0; steerVal = 0;
      document.getElementById("sVal").innerText = 0;
      sendData();
    };

    // Throttle Listener
    throttleSlider.oninput = function() {
      throttleVal = this.value;
      document.getElementById("tVal").innerText = throttleVal;
      sendData();
    };
    // Auto-stop Throttle on release
    throttleSlider.onchange = function() {
      this.value = 0; throttleVal = 0;
      document.getElementById("tVal").innerText = 0;
      sendData();
    };

    // Lights
    function toggleLight() {
      lightState = !lightState ? 1 : 0;
      document.getElementById("btnLight").className = lightState ? "btn btn-on" : "btn btn-off";
      db.ref('car/lights').set(lightState);
    }

    // Horn
    function setHorn(state) {
      document.getElementById("btnHorn").className = state ? "btn btn-on" : "btn btn-off";
      db.ref('car/horn').set(state);
    }
  </script>
</body>
</html>
